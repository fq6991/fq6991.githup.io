<!DOCTYPE HTML>
<html lang="en">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Hexo">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.3.0">
    <meta name="root" content="/fq6991.githup.io/">
    <link rel="dns-prefetch" href="http://example.com">
    <!--SEO-->

<meta name="keywords" content="react基础" />


<meta name="description" content="关于 React此部分内容，做为了解和阅读的内容，除了解决方案和创建项目之外，不会重点说明。
React 的起源和发展React 起源于 Facebook 的内部项目，因为该公司对市场上所有 J..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    Hello World |
    
    Hexo
</title>

<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/fq6991.githup.io/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/fq6991.githup.io/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/fq6991.githup.io/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 5.4.0"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='John Doe'>
            <img src="/fq6991.githup.io/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/fq6991.githup.io/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://example.com">
                        Hexo</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                Home</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="fq6991.githup.io/categories/前端/"><i class="fa "></i>
                                前端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="fq6991.githup.io/categories/后端/"><i class="fa "></i>
                                后端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="fq6991.githup.io/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="fq6991.githup.io/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Hello World">
            
                    Hello World
                        
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/fq6991.githup.io/categories/%E5%89%8D%E7%AB%AF/">前端</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-none-link" href="/fq6991.githup.io/tags/react%E5%9F%BA%E7%A1%80/" rel="tag">react基础</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2021/12/26</span>
    </span>
    
    
</div>
            
                
    </div>
    
        <div class="post-body post-content">
            <h1 id="关于-React"><a href="#关于-React" class="headerlink" title="关于 React"></a>关于 React</h1><p>此部分内容，做为了解和阅读的内容，除了解决方案和创建项目之外，不会重点说明。</p>
<h2 id="React-的起源和发展"><a href="#React-的起源和发展" class="headerlink" title="React 的起源和发展"></a>React 的起源和发展</h2><p>React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架，都不满意，就决定自己写一套，用来架设 Instagram 的网站。做出来以后，发现这套东西很好用，就在 2013 年 5 月开源了。</p>
<h2 id="React-与传统-MVC-的关系"><a href="#React-与传统-MVC-的关系" class="headerlink" title="React 与传统 MVC 的关系"></a>React 与传统 MVC 的关系</h2><p>轻量级的视图层<strong>库</strong>！<em>A JavaScript library for building user interfaces</em></p>
<p>React 不是一个完整的 MVC 框架，最多可以认为是 MVC 中的 V（View），甚至 React 并不非常认可 MVC 开发模式；React 构建页面 UI 的库。可以简单地理解为，React 将将界面分成了各个独立的小块，每一个块就是组件，这些组件之间可以组合、嵌套，就成了我们的页面。</p>
<h2 id="React-高性能的体现：虚拟-DOM"><a href="#React-高性能的体现：虚拟-DOM" class="headerlink" title="React 高性能的体现：虚拟 DOM"></a>React 高性能的体现：虚拟 DOM</h2><h5 id="React-高性能的原理："><a href="#React-高性能的原理：" class="headerlink" title="React 高性能的原理："></a>React 高性能的原理：</h5><p>在 Web 开发中我们总需要将变化的数据实时反应到 UI 上，这时就需要对 DOM 进行操作。而复杂或频繁的 DOM 操作通常是性能瓶颈产生的原因（如何进行高性能的复杂 DOM 操作通常是衡量一个前端开发人员技能的重要指标）。</p>
<p>React 为此引入了虚拟 DOM（Virtual DOM）的机制：在浏览器端用 Javascript 实现了一套 DOM API。基于 React 进行开发时所有的 DOM 构造都是通过虚拟 DOM 进行，每当数据变化时，React 都会重新构建整个 DOM 树，然后 React 将当前整个 DOM 树和上一次的 DOM 树进行对比，得到 DOM 结构的区别，然后仅仅将需要变化的部分进行实际的浏览器 DOM 更新。而且 React 能够批处理虚拟 DOM 的刷新，在一个事件循环（Event Loop）内的两次数据变化会被合并，例如你连续的先将节点内容从 A-B,B-A，React 会认为 A 变成 B，然后又从 B 变成 A UI 不发生任何变化，而如果通过手动控制，这种逻辑通常是极其复杂的。</p>
<p>尽管每一次都需要构造完整的虚拟 DOM 树，但是因为虚拟 DOM 是内存数据，性能是极高的，部而对实际 DOM 进行操作的仅仅是 Diff 分，因而能达到提高性能的目的。这样，在保证性能的同时，开发者将不再需要关注某个数据的变化如何更新到一个或多个具体的 DOM 元素，而只需要关心在任意一个数据状态下，整个界面是如何 Render 的。</p>
<h5 id="React-Fiber"><a href="#React-Fiber" class="headerlink" title="React Fiber:"></a>React Fiber:</h5><p>在 react 16 之后发布的一种 react 核心算法，<strong>React Fiber 是对核心算法的一次重新实现</strong>(官网说法)。之前用的是 diff 算法。</p>
<p>在之前 React 中，更新过程是同步的，这可能会导致性能问题。</p>
<p>当 React 决定要加载或者更新组件树时，会做很多事，比如调用各个组件的生命周期函数，计算和比对 Virtual DOM，最后更新 DOM 树，这整个过程是同步进行的，也就是说只要一个加载或者更新过程开始，中途不会中断。因为 JavaScript 单线程的特点，如果组件树很大的时候，每个同步任务耗时太长，就会出现卡顿。</p>
<p>React Fiber 的方法其实很简单——分片。把一个耗时长的任务分成很多小片，每一个小片的运行时间很短，虽然总时间依然很长，但是在每个小片执行完之后，都给其他任务一个执行的机会，这样唯一的线程就不会被独占，其他任务依然有运行的机会。</p>
<h2 id="React-的特点和优势"><a href="#React-的特点和优势" class="headerlink" title="React 的特点和优势"></a>React 的特点和优势</h2><ol>
<li>虚拟 DOM</li>
</ol>
<p>之前您操作 dom 的方式是通过 document.getElementById()的方式，这样的过程实际上是先去读取 html 的 dom 结构，将结构转换成变量，再进行操作</p>
<p>而 reactjs 定义了一套变量形式的 dom 模型，一切操作和换算直接在变量中，这样减少了操作真实 dom，性能真实相当的高，和主流 MVC 框架有本质的区别，并不和 dom 打交道</p>
<ol start="2">
<li>组件系统</li>
</ol>
<p>react 最核心的思想是将页面中任何一个区域或者元素都可以看做一个组件 component</p>
<p>那么什么是组件呢？</p>
<p>组件指的就是同时包含了 html、css、js、image 元素的聚合体</p>
<p>使用 react 开发的核心就是将页面拆分成若干个组件，并且 react 一个组件中同时耦合了 css、js、image，这种模式整个颠覆了过去的传统的方式</p>
<ol start="3">
<li>单向数据流</li>
</ol>
<p>其实 reactjs 的核心内容就是数据绑定，所谓数据绑定指的是只要将一些服务端的数据和前端页面绑定好，开发者只关注实现业务就行了</p>
<ol start="4">
<li>JSX 语法</li>
</ol>
<p>在 vue 中，我们使用 render 函数来构建组件的 dom 结构性能较高，因为省去了查找和编译模板的过程，但是在 render 中利用 createElement 创建结构的时候代码可读性较低，较为复杂，此时可以利用 jsx 语法来在 render 中创建 dom，解决这个问题，但是前提是需要使用工具来编译 jsx</p>
<h2 id="React-相关的解决方案"><a href="#React-相关的解决方案" class="headerlink" title="React 相关的解决方案"></a>React 相关的解决方案</h2><ul>
<li>web: react-dom + react-router</li>
<li>app: react-native + react-navigation</li>
<li>VR: react-360</li>
<li>状态管理: redux/mobx…</li>
<li>UI 框架: antd/material…</li>
<li>多端统一解决方案: taro…</li>
<li>相关脚手架: create-react-app/react-native-cli/umi…</li>
<li>调试工具: react-devtools</li>
<li>…</li>
</ul>
<h2 id="官方脚手架-create-react-app"><a href="#官方脚手架-create-react-app" class="headerlink" title="官方脚手架 create-react-app"></a>官方脚手架 create-react-app</h2><p>全局安装 create-react-app</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g create-react-app</span><br></pre></td></tr></table></figure>

<p>创建一个项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ create-react-app your-app 注意命名方式</span><br><span class="line"></span><br><span class="line">Creating a new React app <span class="keyword">in</span> /dir/your-app.</span><br><span class="line"></span><br><span class="line">Installing packages. This might take a couple of minutes. 安装过程较慢，可以使用yarn</span><br><span class="line">Installing react, react-dom, and react-scripts...</span><br></pre></td></tr></table></figure>

<p>如果不想全局安装，可以直接使用 npx</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx create-react-app your-app	也可以实现相同的效果</span><br></pre></td></tr></table></figure>

<p>这需要等待一段时间，这个过程实际上会安装三个东西</p>
<ul>
<li>react: react 的顶级库</li>
<li>react-dom: 因为 react 有很多的运行环境，比如 app 端的 react-native, 我们要在 web 上运行就使用 react-dom</li>
<li>react-scripts: 包含运行和打包 react 应用程序的所有脚本及配置，要了解更多的配置可以系统学习一下 webpack.</li>
</ul>
<p>出现下面的界面，表示创建项目成功:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Success! Created your-app at /dir/your-app</span><br><span class="line">Inside that directory, you can run several commands:</span><br><span class="line"></span><br><span class="line">  npm start</span><br><span class="line">    Starts the development server.</span><br><span class="line"></span><br><span class="line">  npm run build</span><br><span class="line">    Bundles the app into static files <span class="keyword">for</span> production.</span><br><span class="line"></span><br><span class="line">  npm <span class="built_in">test</span></span><br><span class="line">    Starts the <span class="built_in">test</span> runner.</span><br><span class="line"></span><br><span class="line">  npm run eject</span><br><span class="line">    Removes this tool and copies build dependencies, configuration files</span><br><span class="line">    and scripts into the app directory. If you <span class="keyword">do</span> this, you can’t go back!</span><br><span class="line"></span><br><span class="line">We suggest that you begin by typing:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cd</span> your-app</span><br><span class="line">  npm start</span><br><span class="line"></span><br><span class="line">Happy hacking!</span><br></pre></td></tr></table></figure>

<p>根据上面的提示，通过<code>cd your-app</code>命令进入目录并运行<code>npm start</code>即可运行项目。</p>
<p>生成项目的目录结构如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── README.md							使用方法的文档</span><br><span class="line">├── node_modules					所有的依赖安装的目录</span><br><span class="line">├── package-lock.json			锁定安装时的包的版本号,保证团队的依赖能保证一致。</span><br><span class="line">├── package.json</span><br><span class="line">├── public								静态公共目录</span><br><span class="line">└── src										开发用的源代码目录</span><br></pre></td></tr></table></figure>

<p>常见问题：</p>
<ul>
<li>npm 安装失败<ul>
<li>切换为 npm 镜像为淘宝镜像</li>
<li>使用 yarn，如果本来使用 yarn 还要失败，还得把 yarn 的源切换到国内</li>
<li>如果还没有办法解决，请删除 node_modules 及 package-lock.json 然后重新执行<code>npm install命令</code></li>
<li>再不能解决就删除 node_modules 及 package-lock.json 的同时清除 npm 缓存<code>npm cache clean --force</code>之后再执行<code>npm install</code>命令</li>
</ul>
</li>
</ul>
<h1 id="编写第一个-react-应用程序"><a href="#编写第一个-react-应用程序" class="headerlink" title="编写第一个 react 应用程序"></a>编写第一个 react 应用程序</h1><p>react 开发需要引入多个依赖文件：react.js、react-dom.js，分别又有开发版本和生产版本，create-react-app 里已经帮我们把这些东西都安装好了。把通过 CRA 创建的工程目录下的 src 目录清空，然后在里面重新创建一个 index.js. 写入以下代码:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 react 的包当中引入了 React。只要你要写 React.js 组件就必须引入React, 因为react里有一种语法叫JSX，稍后会说到JSX，要写JSX，就必须引入React</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// ReactDOM 可以帮助我们把 React 组件渲染到页面上去，没有其它的作用了。它是从 react-dom 中引入的，而不是从 react 引入。</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReactDOM里有一个render方法，功能就是把组件渲染并且构造 DOM 树，然后插入到页面上某个特定的元素上</span></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="comment">// 这里就比较奇怪了，它并不是一个字符串，看起来像是纯 HTML 代码写在 JavaScript 代码里面。语法错误吗？这并不是合法的 JavaScript 代码, “在 JavaScript 写的标签的”语法叫 JSX- JavaScript XML。</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>,</span><br><span class="line">  <span class="comment">// 渲染到哪里</span></span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h1 id="元素与组件"><a href="#元素与组件" class="headerlink" title="元素与组件"></a>元素与组件</h1><p>如果代码多了之后，不可能一直在 render 方法里写，所以就需要把里面的代码提出来，定义一个变量，像这样：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="comment">// 这里感觉又不习惯了？这是在用JSX定义一下react元素</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">ReactDOM.render(app, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="函数式组件"><a href="#函数式组件" class="headerlink" title="函数式组件"></a>函数式组件</h2><p>由于元素没有办法传递参数，所以我们就需要把之前定义的变量改为一个方法，让这个方法去 return 一个元素:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特别注意这里的写法，如果要在JSX里写js表达式(只能是表达式，不能流程控制)，就需要加 &#123;&#125;，包括注释也是一样，并且可以多层嵌套</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  app(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这里我们定义的方法实际上也是 react 定义组件的第一种方式-定义函数式组件，这也是无状态组件，当然在最新的 React 里面可以使用 hooks 让函数式组件也可以有自己的状态。但是这种写法不符合 react 的 jsx 的风格，更好的方式是使用以下方式进行改造</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="comment">// React组件的调用方式</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">name</span>=<span class="string">&quot;react&quot;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这样一个完整的函数式组件就定义好了。但要<strong>注意！注意！注意！</strong>组件名必须<strong>大写</strong>，否则报错。</p>
<h2 id="class-组件"><a href="#class-组件" class="headerlink" title="class 组件"></a>class 组件</h2><p>ES6 的加入让 JavaScript 直接支持使用 class 来定义一个类，react 的第二种创建组件的方式就是使用的类的继承，它使用了 ES6 标准语法来构建，看以下代码：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="comment">// 注意这里得用this.props.name, 必须用this.props</span></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">name</span>=<span class="string">&quot;react&quot;</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>运行结果和之前完全一样，因为 JS 里没有真正的 class，这个 class 只是一个语法糖, 但二者的运行机制底层运行机制不一样。</p>
<ul>
<li><p>函数式组件是直接调用, 在前面的代码里已经有看到</p>
</li>
<li><p><code>es6 class</code>组件其实就是一个构造器,每次使用组件都相当于在实例化组件，像这样：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> App(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">&#125;).render();</span><br><span class="line"></span><br><span class="line">ReactDOM.render(app, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="更老的一种方法"><a href="#更老的一种方法" class="headerlink" title="更老的一种方法"></a>更老的一种方法</h2><p>在 16 以前的版本还支持这样创建组件, 但现在的项目基本上不用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.xxx&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="组件的组合、嵌套"><a href="#组件的组合、嵌套" class="headerlink" title="组件的组合、嵌套"></a>组件的组合、嵌套</h2><p>将一个组件渲染到某一个节点里的时候，会将这个节点里原有内容覆盖</p>
<p>组件嵌套的方式就是将子组件写入到父组件的模板中去，且 react 没有 Vue 中的内容分发机制（slot），所以我们在一个组件的模板中只能看到父子关系</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 react 的包当中引入了 React 和 React.js 的组件父类 Component</span></span><br><span class="line"><span class="comment">// 还引入了一个React.js里的一种特殊的组件 Fragment</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component, Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Content</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>React.js是一个构建UI的库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 由于每个React组件只能有一个根节点，所以要渲染多个组件的时候，需要在最外层包一个容器，如果使用div, 会生成多余的一层dom</span></span><br><span class="line"><span class="comment">class App extends Component &#123;</span></span><br><span class="line"><span class="comment">  render () &#123;</span></span><br><span class="line"><span class="comment">    return (</span></span><br><span class="line"><span class="comment">    	&lt;div&gt;</span></span><br><span class="line"><span class="comment">    		&lt;Title /&gt;</span></span><br><span class="line"><span class="comment">        &lt;Content /&gt;</span></span><br><span class="line"><span class="comment">      &lt;/div&gt;</span></span><br><span class="line"><span class="comment">  	)</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="comment">// 如果不想生成多余的一层dom可以使用React提供的Fragment组件在最外层进行包裹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Title</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Content</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>#JSX 原理</p>
<p>要明白 JSX 的原理，需要先明白如何用 JavaScript 对象来表现一个 DOM 元素的结构?</p>
<p>看下面的 DOM 结构</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span> <span class="attr">id</span>=<span class="string">&quot;appRoot&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>欢迎学习React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>React.js 是一个帮助你构建页面的 UI 库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面这个 HTML 所有的信息我们都可以用 JavaScript 对象来表示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">tag</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">attrs</span>: &#123; <span class="attr">className</span>: <span class="string">&#x27;app&#x27;</span>, <span class="attr">id</span>: <span class="string">&#x27;appRoot&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;h1&#x27;</span>,</span><br><span class="line">      <span class="attr">attrs</span>: &#123; <span class="attr">className</span>: <span class="string">&#x27;title&#x27;</span> &#125;,</span><br><span class="line">      <span class="attr">children</span>: [<span class="string">&#x27;欢迎学习React&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">      <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">children</span>: [<span class="string">&#x27;React.js 是一个构建页面的 UI 库&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是用 JavaScript 写起来太长了，结构看起来又不清晰，用 HTML 的方式写起来就方便很多了。</p>
<p>于是 React.js 就把 JavaScript 的语法扩展了一下，让 JavaScript 语言能够支持这种直接在 JavaScript 代码里面编写类似 HTML 标签结构的语法，这样写起来就方便很多了。编译的过程会把类似 HTML 的 JSX 结构转换成 JavaScript 的对象结构。</p>
<p>下面代码:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span> <span class="attr">id</span>=<span class="string">&quot;appRoot&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>欢迎学习React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>React.js 是一个构建页面的 UI 库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>编译之后将得到这样的代码:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(</span><br><span class="line">      <span class="string">&quot;div&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">className</span>: <span class="string">&quot;app&quot;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&quot;appRoot&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      React.createElement(<span class="string">&quot;h1&quot;</span>, &#123; <span class="attr">className</span>: <span class="string">&quot;title&quot;</span> &#125;, <span class="string">&quot;欢迎学习React&quot;</span>),</span><br><span class="line">      React.createElement(<span class="string">&quot;p&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;React.js 是一个构建页面的 UI 库&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(React.createElement(App), <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><code>React.createElement</code> 会构建一个 JavaScript 对象来描述你 HTML 结构的信息，包括标签名、属性、还有子元素等, 语法为</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(type, [props], [...children]);</span><br></pre></td></tr></table></figure>

<p>所谓的 JSX 其实就是 JavaScript 对象，所以使用 React 和 JSX 的时候一定要经过编译的过程:</p>
<blockquote>
<p>JSX —使用 react 构造组件，bable 进行编译—&gt; JavaScript 对象 — <code>ReactDOM.render()</code>—&gt;DOM 元元素 —&gt;插入页面</p>
</blockquote>
<p>#组件中 DOM 样式</p>
<ul>
<li>行内样式</li>
</ul>
<p>想给虚拟 dom 添加行内样式，需要使用表达式传入样式对象的方式来实现：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意这里的两个括号，第一个表示我们在要JSX里插入JS了，第二个是对象的括号</span></span><br><span class="line">&lt;p style=&#123;&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">fontSize</span>: <span class="string">&quot;14px&quot;</span> &#125;&#125;&gt;Hello world&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>行内样式需要写入一个样式对象，而这个样式对象的位置可以放在很多地方，例如<code>render</code>函数里、组件原型上、外链 js 文件中</p>
<ul>
<li>使用<code>class</code></li>
</ul>
<p>React 推荐我们使用行内样式，因为 React 觉得每一个组件都是一个独立的整体</p>
<p>其实我们大多数情况下还是大量的在为元素添加类名，但是需要注意的是，<code>class</code>需要写成<code>className</code>（因为毕竟是在写类 js 代码，会收到 js 规则的现在，而<code>class</code>是关键字）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p className=<span class="string">&quot;hello&quot;</span> style=&#123;<span class="built_in">this</span>.style&#125;&gt;</span><br><span class="line">  Hello world</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>不同的条件添加不同的样式</li>
</ul>
<p>有时候需要根据不同的条件添加不同的样式，比如：完成状态，完成是绿色，未完成是红色。那么这种情况下，我们推荐使用<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/classnames">classnames</a>这个包：</p>
<ul>
<li>css-in-js</li>
</ul>
<p><code>style-components</code>是针对 React 写的一套 css-in-js 框架，简单来讲就是在 js 中写 css。<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/styled-components">npm 链接</a></p>
<p>#TodoList 最经典的前端练习</p>
<p>组件化开发 React todolist， 项目开发中的组件的基本目录结构基本上是这样的：</p>
<blockquote>
<p>/your-project</p>
<ul>
<li>src<ul>
<li>…</li>
<li>components<ul>
<li>YourComponentOne<ul>
<li>index.js/YourComponentOne.js</li>
</ul>
</li>
<li>YourComponentTwo<ul>
<li>index.js/YourComponentTwo.js</li>
</ul>
</li>
<li>index.js 用于导出组件</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>注意：一个组件只干一件事情 ，所以 TodoList 和 TodoItem 要做成两个组件，这样也方便于后期理解 shouldComponentUpdate</p>
<h1 id="组件的数据挂载方式"><a href="#组件的数据挂载方式" class="headerlink" title="组件的数据挂载方式"></a>组件的数据挂载方式</h1><h2 id="属性-props"><a href="#属性-props" class="headerlink" title="属性(props)"></a>属性(props)</h2><p><code>props</code>是正常是外部传入的，组件内部也可以通过一些方式来初始化的设置，属性不能被组件自己更改，但是你可以通过父组件主动重新渲染的方式来传入新的 <code>props</code></p>
<p>属性是描述性质、特点的，组件自己不能随意更改。</p>
<p>之前的组件代码里面有<code>props</code>的简单使用，总的来说，在使用一个组件的时候，可以把参数放在标签的属性当中，所有的属性都会作为组件 <code>props</code> 对象的键值。通过箭头函数创建的组件，需要通过函数的参数来接收<code>props</code>:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Content = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;props.name&#125;是一个构建UI的库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Title</span> <span class="attr">name</span>=<span class="string">&quot;React&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Content</span> <span class="attr">name</span>=<span class="string">&quot;React.js&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>###设置组件的默认 props</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 使用类创建的组件，直接在这里写static方法，创建defaultProps</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Content = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;props.name&#125;是一个构建UI的库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用箭头函数创建的组件，需要在这个组件上直接写defaultProps属性</span></span><br><span class="line">Content.defaultProps = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;React.js&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;/* 由于设置了defaultProps， 不传props也能正常运行，如果传递了就会覆盖defaultProps的值 */&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Title</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Content</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="props-children"><a href="#props-children" class="headerlink" title="props.children"></a>props.children</h3><p>我们知道使用组件的时候，可以嵌套。要在自定义组件的使用嵌套结构，就需要使用 <code>props.children</code> 。在实际的工作当中，我们几乎每天都需要用这种方式来编写组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Content = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Title</span>&gt;</span>React<span class="tag">&lt;/<span class="name">Title</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">i</span>&gt;</span>React.js<span class="tag">&lt;/<span class="name">i</span>&gt;</span>是一个构建UI的库</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="使用-prop-types-检查-props"><a href="#使用-prop-types-检查-props" class="headerlink" title="使用 prop-types 检查 props"></a>使用 prop-types 检查 props</h3><p>React 其实是为了构建大型应用程序而生, 在一个大型应用中，根本不知道别人使用你写的组件的时候会传入什么样的参数，有可能会造成应用程序运行不了，但是不报错。为了解决这个问题，React 提供了一种机制，让写组件的人可以给组件的<code>props</code>设定参数检查，需要安装和使用<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/prop-types">prop-types</a>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i prop-types -S</span><br></pre></td></tr></table></figure>

<p>##状态(state)</p>
<p>状态就是组件描述某种显示情况的数据，由组件自己设置和更改，也就是说由组件自己维护，使用状态的目的就是为了在不同的状态下使组件的显示不同(自己管理)</p>
<p>###定义 state</p>
<p>第一种方式</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">    <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.state.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>&#123;this.state.isLiked ? &quot;❤️取消&quot; : &quot;🖤收藏&quot;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>另一种方式(推荐)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">      <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.state.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>&#123;this.state.isLiked ? &quot;❤️取消&quot; : &quot;🖤收藏&quot;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><code>this.props</code>和<code>this.state</code>是纯 js 对象,在 vue 中，data 属性是利用<code>Object.defineProperty</code>处理过的，更改 ​data 的数据的时候会触发数据的<code>getter</code>和<code>setter</code>，但是 React 中没有做这样的处理，如果直接更改的话，react 是无法得知的，所以，需要使用特殊的更改状态的方法<code>setState</code>。</p>
<p>###setState</p>
<p><code>isLiked</code> 存放在实例的 <code>state</code> 对象当中，组件的 <code>render</code> 函数内，会根据组件的 <code>state</code> 的中的<code>isLiked</code>不同显示“取消”或“收藏”内容。下面给 <code>button</code> 加上了点击的事件监听。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">      <span class="attr">isLiked</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleBtnClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">isLiked</span>: !<span class="built_in">this</span>.state.isLiked,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎学习&#123;this.state.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleBtnClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;this.state.isLiked ? &quot;❤️取消&quot; : &quot;🖤收藏&quot;&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><code>setState</code>有两个参数</p>
<p>第一个参数可以是对象，也可以是方法 return 一个对象，我们把这个参数叫做<code>updater</code></p>
<ul>
<li><p>参数是对象</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  <span class="attr">isLiked</span>: !<span class="built_in">this</span>.state.isLiked,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>参数是方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(<span class="function">(<span class="params">prevState, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">isLiked</span>: !prevState.isLiked,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意的是这个方法接收两个参数，第一个是上一次的 state, 第二个是 props</p>
</li>
</ul>
<p><code>setState</code>是异步的，所以想要获取到最新的 state，没有办法获取，就有了第二个参数，这是一个可选的回调函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setState(</span><br><span class="line">  <span class="function">(<span class="params">prevState, props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">isLiked</span>: !prevState.isLiked,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;回调里的&quot;</span>, <span class="built_in">this</span>.state.isLiked);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;setState外部的&quot;</span>, <span class="built_in">this</span>.state.isLiked);</span><br></pre></td></tr></table></figure>

<h2 id="属性-vs-状态"><a href="#属性-vs-状态" class="headerlink" title="属性 vs 状态"></a>属性 vs 状态</h2><p>相似点：都是纯 js 对象，都会触发 render 更新，都具有确定性（状态/属性相同，结果相同）</p>
<p>不同点：</p>
<ol>
<li>属性能从父组件获取，状态不能</li>
<li>属性可以由父组件修改，状态不能</li>
<li>属性能在内部设置默认值，状态也可以</li>
<li>属性不在组件内部修改，状态要改</li>
<li>属性能设置子组件初始值，状态不可以</li>
<li>属性可以修改子组件的值，状态不可以</li>
</ol>
<p><code>state</code> 的主要作用是用于组件保存、控制、修改自己的可变状态。<code>state</code> 在组件内部初始化，可以被组件自身修改，而外部不能访问也不能修改。你可以认为 <code>state</code> 是一个局部的、只能被组件自身控制的数据源。<code>state</code> 中状态可以通过 <code>this.setState</code>方法进行更新，<code>setState</code> 会导致组件的重新渲染。</p>
<p><code>props</code> 的主要作用是让使用该组件的父组件可以传入参数来配置该组件。它是外部传进来的配置参数，组件内部无法控制也无法修改。除非外部组件主动传入新的 <code>props</code>，否则组件的 <code>props</code> 永远保持不变。</p>
<p>如果搞不清 <code>state</code> 和 <code>props</code> 的使用场景，记住一个简单的规则：**尽量少地用 <code>state</code>，多用 <code>props</code>**。</p>
<p>没有 <code>state</code> 的组件叫无状态组件（stateless component），设置了 state 的叫做有状态组件（stateful component）。因为状态会带来管理的复杂性，我们尽量多地写无状态组件，尽量少地写有状态的组件。这样会降低代码维护的难度，也会在一定程度上增强组件的可复用性。</p>
<p>##状态提升</p>
<p>如果有多个组件共享一个数据，把这个数据放到共同的父级组件中来管理</p>
<h2 id="受控组件与非受控组件"><a href="#受控组件与非受控组件" class="headerlink" title="受控组件与非受控组件"></a>受控组件与非受控组件</h2><p>React 组件的数据渲染是否被调用者传递的<code>props</code>完全控制，控制则为受控组件，否则非受控组件。</p>
<h2 id="渲染数据"><a href="#渲染数据" class="headerlink" title="渲染数据"></a>渲染数据</h2><ul>
<li><p>条件渲染</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  condition ? <span class="string">&quot;❤️取消&quot;</span> : <span class="string">&quot;🖤收藏&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>列表渲染</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="keyword">const</span> people = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Leo&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">35</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;XiaoMing&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">16</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">// 渲染列表</span></span><br><span class="line">&#123;</span><br><span class="line">  people.map(<span class="function">(<span class="params">person</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">dl</span> <span class="attr">key</span>=<span class="string">&#123;person.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>&#123;person.name&#125;<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>age: &#123;person.age&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>React 的高效依赖于所谓的 Virtual-DOM，尽量不碰 DOM。对于列表元素来说会有一个问题：元素可能会在一个列表中改变位置。要实现这个操作，只需要交换一下 DOM 位置就行了，但是 React 并不知道其实我们只是改变了元素的位置，所以它会重新渲染后面两个元素（再执行 Virtual-DOM ），这样会大大增加 DOM 操作。但如果给每个元素加上唯一的标识，React 就可以知道这两个元素只是交换了位置，这个标识就是<code>key</code>，这个 <code>key</code> 必须是每个元素唯一的标识</p>
<ul>
<li>dangerouslySetHTML</li>
</ul>
<p>对于富文本创建的内容，后台拿到的数据是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="string">&quot;&lt;p&gt;React.js是一个构建UI的库&lt;/p&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>处于安全的原因，React 当中所有表达式的内容会被转义，如果直接输入，标签会被当成文本。这时候就需要使用<code>dangerouslySetHTML</code>属性，它允许我们动态设置<code>innerHTML</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&quot;&lt;p&gt;React.js是一个构建UI的库&lt;/p&gt;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        // 注意这里是两个下划线 <span class="attr">__html</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span> <span class="attr">__html:</span> <span class="attr">this.state.content</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">      /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h1 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h1><h2 id="绑定事件"><a href="#绑定事件" class="headerlink" title="绑定事件"></a>绑定事件</h2><p>采用 on+事件名的方式来绑定一个事件，注意，这里和原生的事件是有区别的，原生的事件全是小写<code>onclick</code>, React 里的事件是驼峰<code>onClick</code>，<strong>React 的事件并不是原生事件，而是合成事件</strong>。</p>
<h2 id="事件-handler-的写法"><a href="#事件-handler-的写法" class="headerlink" title="事件 handler 的写法"></a>事件 handler 的写法</h2><ul>
<li>直接在 render 里写行内的箭头函数(不推荐)</li>
<li>在组件内使用箭头函数定义一个方法(推荐)</li>
<li>直接在组件内定义一个非箭头函数的方法，然后在 render 里直接使用<code>onClick=&#123;this.handleClick.bind(this)&#125;</code>(不推荐)</li>
<li>直接在组件内定义一个非箭头函数的方法，然后在 constructor 里 bind(this)(推荐)</li>
</ul>
<h2 id="Event-对象"><a href="#Event-对象" class="headerlink" title="Event 对象"></a>Event 对象</h2><p>和普通浏览器一样，事件 handler 会被自动传入一个 <code>event</code> 对象，这个对象和普通的浏览器 <code>event</code> 对象所包含的方法和属性都基本一致。不同的是 React 中的 <code>event</code> 对象并不是浏览器提供的，而是它自己内部所构建的。它同样具有<code>event.stopPropagation</code>、<code>event.preventDefault</code> 这种常用的方法</p>
<h2 id="事件的参数传递"><a href="#事件的参数传递" class="headerlink" title="事件的参数传递"></a>事件的参数传递</h2><ul>
<li>在<code>render</code>里调用方法的地方外面包一层箭头函数</li>
<li>在<code>render</code>里通过<code>this.handleEvent.bind(this, 参数)</code>这样的方式来传递</li>
<li>通过<code>event</code>传递</li>
<li>比较推荐的是做一个子组件, 在父组件中定义方法，通过<code>props</code>传递到子组件中，然后在子组件件通过<code>this.props.method</code>来调用</li>
</ul>
<p>##处理用户输入</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">xing</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">ming</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleInputChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      [e.target.name]: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; xing, ming &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>姓:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">name</span>=<span class="string">&quot;xing&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">value</span>=<span class="string">&#123;xing&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onChange</span>=<span class="string">&#123;this.handleInputChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>名:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">name</span>=<span class="string">&quot;ming&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">value</span>=<span class="string">&#123;ming&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">onChange</span>=<span class="string">&#123;this.handleInputChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">          欢迎您: &#123;xing&#125;</span></span><br><span class="line"><span class="xml">          &#123;ming&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h1 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h1><p>React 中组件也有生命周期，也就是说也有很多钩子函数供我们使用, 组件的生命周期，我们会分为四个阶段，初始化、运行中、销毁、错误处理(16.3 之后)</p>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>在组件初始化阶段会执行  <br>1. constructor <br>2. static getDerivedStateFromProps()<br>3. componentWillMount() / UNSAFE_componentWillMount() <br>4. render() <br>5. componentDidMount()</p>
<p>##更新阶段</p>
<p><code>props</code>或<code>state</code>的改变可能会引起组件的更新，组件重新渲染的过程中会调用以下方法：</p>
<p>1. componentWillReceiveProps() / UNSAFE_componentWillReceiveProps() <br>2. static getDerivedStateFromProps()<br>3. shouldComponentUpdate() <br>4. componentWillUpdate() / UNSAFE_componentWillUpdate() <br>5. render() <br>6. getSnapshotBeforeUpdate() <br>7. componentDidUpdate()</p>
<p>##卸载阶段</p>
<ol>
<li>componentWillUnmount()</li>
</ol>
<p>##错误处理</p>
<ol>
<li>componentDidCatch()</li>
</ol>
<p>##各生命周期详解</p>
<p>#####1.constructor(props)</p>
<p>React 组件的构造函数在挂载之前被调用。在实现<code>React.Component</code>构造函数时，需要先在添加其他内容前，调用<code>super(props)</code>，用来将父组件传来的<code>props</code>绑定到这个类中，使用<code>this.props</code>将会得到。</p>
<p>官方建议不要在<code>constructor</code>引入任何具有副作用和订阅功能的代码，这些应当使用<code>componentDidMount()</code>。</p>
<p><code>constructor</code>中应当做些初始化的动作，如：初始化<code>state</code>，将事件处理函数绑定到类实例上，但也不要使用<code>setState()</code>。如果没有必要初始化 state 或绑定方法，则不需要构造<code>constructor</code>，或者把这个组件换成纯函数写法。</p>
<p>当然也可以利用<code>props</code>初始化<code>state</code>，在之后修改<code>state</code>不会对<code>props</code>造成任何修改，但仍然建议大家提升状态到父组件中，或使用<code>redux</code>统一进行状态管理。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(props);</span><br><span class="line">  <span class="built_in">this</span>.state = &#123;</span><br><span class="line">    <span class="attr">isLiked</span>: props.isLiked</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>#####2.static getDerivedStateFromProps(nextProps, prevState)</p>
<p><code>getDerivedStateFromProps</code> 是 react16.3 之后新增，在组件实例化后，和接受新的<code>props</code>后被调用。他必须返回一个对象来更新状态，或者返回 null 表示新的 props 不需要任何 state 的更新。</p>
<p>如果是由于父组件的<code>props</code>更改，所带来的重新渲染，也会触发此方法。</p>
<p>调用<code>steState()</code>不会触发<code>getDerivedStateFromProps()</code>。</p>
<p>之前这里都是使用<code>constructor</code>+<code>componentWillRecieveProps</code>完成相同的功能的</p>
<p>#####3. componentWillMount() / UNSAFE_componentWillMount()</p>
<p><code>componentWillMount()</code>将在 React 未来版本(官方说法 17.0)中被弃用。<code>UNSAFE_componentWillMount()</code>在组件挂载前被调用，在这个方法中调用<code>setState()</code>不会起作用，是由于他在<code>render()</code>前被调用。</p>
<p>为了避免副作用和其他的订阅，官方都建议使用<code>componentDidMount()</code>代替。这个方法是用于在服务器渲染上的唯一方法。这个方法因为是在渲染之前被调用，也是惟一一个可以直接同步修改 state 的地方。</p>
<p>#####4.render()</p>
<p>render()方法是必需的。当他被调用时，他将计算<code>this.props</code>和<code>this.state</code>，并返回以下一种类型：</p>
<ol>
<li>React 元素。通过 jsx 创建，既可以是 dom 元素，也可以是用户自定义的组件。</li>
<li>字符串或数字。他们将会以文本节点形式渲染到 dom 中。</li>
<li>Portals。react 16 版本中提出的新的解决方案，可以使组件脱离父组件层级直接挂载在 DOM 树的任何位置。 <br>4. null，什么也不渲染</li>
<li>布尔值。也是什么都不渲染。</li>
</ol>
<p>当返回<code>null</code>,<code>false</code>,<code>ReactDOM.findDOMNode(this)</code>将会返回 null，什么都不会渲染。</p>
<p><code>render()</code>方法必须是一个纯函数，他不应该改变<code>state</code>，也不能直接和浏览器进行交互，应该将事件放在其他生命周期函数中。<br>如果<code>shouldComponentUpdate()</code>返回<code>false</code>，<code>render()</code>不会被调用。</p>
<p>#####5. componentDidMount</p>
<p><code>componentDidMount</code>在组件被装配后立即调用。初始化使得 DOM 节点应该进行到这里。</p>
<p><strong>通常在这里进行 ajax 请求</strong></p>
<p>如果要初始化第三方的 dom 库，也在这里进行初始化。只有到这里才能获取到真实的 dom.</p>
<p>#####6.componentWillReceiveProps()/UNSAFE_componentWillReceiveProps(nextProps)</p>
<p>官方建议使用<code>getDerivedStateFromProps</code>函数代替<code>componentWillReceiveProps</code>。当组件挂载后，接收到新的<code>props</code>后会被调用。如果需要更新<code>state</code>来响应<code>props</code>的更改，则可以进行<code>this.props</code>和<code>nextProps</code>的比较，并在此方法中使用<code>this.setState()</code>。</p>
<p>如果父组件会让这个组件重新渲染，即使<code>props</code>没有改变，也会调用这个方法。</p>
<p>React 不会在组件初始化 props 时调用这个方法。调用<code>this.setState</code>也不会触发。</p>
<p>#####7.shouldComponentUpdate(nextProps, nextState)</p>
<p>调用<code>shouldComponentUpdate</code>使 React 知道，组件的输出是否受<code>state</code>和<code>props</code>的影响。默认每个状态的更改都会重新渲染，大多数情况下应该保持这个默认行为。</p>
<p>在渲染新的<code>props</code>或<code>state</code>前，<code>shouldComponentUpdate</code>会被调用。默认为<code>true</code>。这个方法不会在初始化时被调用，也不会在<code>forceUpdate()</code>时被调用。返回<code>false</code>不会阻止子组件在<code>state</code>更改时重新渲染。</p>
<p>如果<code>shouldComponentUpdate()</code>返回<code>false</code>，<code>componentWillUpdate</code>,<code>render</code>和<code>componentDidUpdate</code>不会被调用。</p>
<blockquote>
<p>官方并不建议在<code>shouldComponentUpdate()</code>中进行深度查询或使用<code>JSON.stringify()</code>，他效率非常低，并且损伤性能。</p>
</blockquote>
<p>#####8.UNSAFE_componentWillUpdate(nextProps, nextState)</p>
<p>在渲染新的<code>state</code>或<code>props</code>时，<code>UNSAFE_componentWillUpdate</code>会被调用，将此作为在更新发生之前进行准备的机会。这个方法不会在初始化时被调用。</p>
<p>_不能在这里使用 this.setState()_，也不能做会触发视图更新的操作。如果需要更新<code>state</code>或<code>props</code>，调用<code>getDerivedStateFromProps</code>。</p>
<p>#####9.getSnapshotBeforeUpdate()</p>
<p>在 react <code>render()</code>后的输出被渲染到 DOM 之前被调用。它使您的组件能够在它们被潜在更改之前捕获当前值（如滚动位置）。这个生命周期返回的任何值都将作为参数传递给 componentDidUpdate（）。</p>
<p>#####10.componentDidUpdate(prevProps, prevState, snapshot)</p>
<p>在更新发生后立即调用<code>componentDidUpdate()</code>。此方法不用于初始渲染。当组件更新时，将此作为一个机会来操作 DOM。只要您将当前的 props 与以前的 props 进行比较（例如，如果 props 没有改变，则可能不需要网络请求），这也是做网络请求的好地方。</p>
<p>如果组件实现<code>getSnapshotBeforeUpdate()</code>生命周期，则它返回的值将作为第三个“快照”参数传递给<code>componentDidUpdate()</code>。否则，这个参数是<code>undefined</code>。</p>
<p>#####11.componentWillUnmount()</p>
<p>在组件被卸载并销毁之前立即被调用。在此方法中执行任何必要的清理，例如使定时器无效，取消网络请求或清理在<code>componentDidMount</code>中创建的任何监听。</p>
<p>#####12.componentDidCatch(error, info)</p>
<p>错误边界是 React 组件，可以在其子组件树中的任何位置捕获 JavaScript 错误，记录这些错误并显示回退 UI，而不是崩溃的组件树。错误边界在渲染期间，生命周期方法以及整个树下的构造函数中捕获错误。</p>
<p>如果类组件定义了此生命周期方法，则它将成错误边界。在它中调用<code>setState()</code>可以让你在下面的树中捕获未处理的 JavaScript 错误，并显示一个后备 UI。只能使用错误边界从意外异常中恢复; 不要试图将它们用于控制流程。</p>
<p>错误边界只会捕获树中下面组件中的错误。错误边界本身不能捕获错误。</p>
<p>##PureComponent</p>
<p><code>PureComponnet</code>里如果接收到的新属性或者是更改后的状态和原属性、原状态相同的话，就不会去重新 render 了<br>在里面也可以使用<code>shouldComponentUpdate</code>，而且。是否重新渲染以<code>shouldComponentUpdate</code>的返回值为最终的决定因素。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PureComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourComponent</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##ref</p>
<p>React 提供的这个<code>ref</code>属性，表示为对组件真正实例的引用，其实就是<code>ReactDOM.render()</code>返回的组件实例,<code>ref</code>可以挂载到组件上也可以是 dom 元素上。</p>
<ul>
<li>挂到组件(<code>class</code>声明的组件)上的 ref 表示对组件实例的引用。<strong>不能</strong>在函数式组件上使用 ref 属性，因为它们没有实例：</li>
<li>挂载到 dom 元素上时表示具体的 dom 元素节点。</li>
</ul>
<p>在 React 最新的版本中，要使用<code>ref</code>, 需要使用<code>React.createRef</code>方法先生成一个<code>ref</code>。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, createRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="comment">// 创建inputRef</span></span><br><span class="line">    <span class="built_in">this</span>.inputRef = createRef();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.inputRef.current); <span class="comment">// &lt;input type=&quot;text&quot;&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;/* 关联ref和dom */&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;this.inputRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><p>React Hooks 是 React <code>16.7.0-alpha</code> 版本推出的新特性, 有了 React Hooks，在 react 函数组件中，也可以使用类组件（classes components）的 state 和 组件生命周期。通过下面几个例子来学习 React Hooks。</p>
<ul>
<li>State Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState是react包提供的一个方法</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Counter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// useState 这个方法可以为我们的函数组件拥有自己的state，它接收一个用于初始 state 的值，返回一对变量。这里我们把计数器的初始值设置为0, 方法都是以set开始</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了&#123;count&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>Effect Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState是react包提供的一个方法</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Counter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// useState 这个方法可以为我们的函数组件拥有自己的state，它接收一个用于初始 state 的值，返回一对变量。这里我们把计数器的初始值设置为0, 方法都是以set开始</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 类似于componentDidMount或者componentDidUpdate:</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 更改网页的标题，还可以做其它的监听</span></span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`你点击了<span class="subst">$&#123;count&#125;</span>次`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了&#123;count&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>React Hooks 的规则<ul>
<li>只能在<strong>顶层</strong>调用 Hooks。不要在循环，条件或嵌套函数中调用 Hook。</li>
<li>不要从常规 JavaScript 函数中调用 Hook。只在 React 函数式组件调用 Hooks。</li>
</ul>
</li>
<li>自定义 hooks</li>
<li>react 内置 hooks api<ul>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#basic-hooks">Basic Hooks</a><ul>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usestate"><code>useState</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#useeffect"><code>useEffect</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usecontext"><code>useContext</code></a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#additional-hooks">Additional Hooks</a><ul>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usereducer"><code>useReducer</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code>useCallback</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#useref"><code>useRef</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#useimperativehandle"><code>useImperativeHandle</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect"><code>useLayoutEffect</code></a></li>
<li><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-reference.html#usedebugvalue"><code>useDebugValue</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h1><p>父组件与子组件通信</p>
<ul>
<li><p>父组件将自己的状态传递给子组件，子组件当做属性来接收，当父组件更改自己状态的时候，子组件接收到的属性就会发生改变</p>
</li>
<li><p>父组件利用<code>ref</code>对子组件做标记，通过调用子组件的方法以更改子组件的状态,也可以调用子组件的方法..</p>
</li>
</ul>
<p>子组件与父组件通信</p>
<ul>
<li>父组件将自己的某个方法传递给子组件，在方法里可以做任意操作，比如可以更改状态，子组件通过<code>this.props</code>接收到父组件的方法后调用。</li>
</ul>
<p>跨组件通信</p>
<p>在 react 没有类似 vue 中的事件总线来解决这个问题，我们只能借助它们共同的父级组件来实现，将非父子关系装换成多维度的父子关系。react 提供了<code>context</code> api 来实现跨组件通信, React 16.3 之后的<code>context</code>api 较之前的好用。</p>
<p>实例，使用<code>context</code> 实现购物车中的加减功能</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counterContext.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component, createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Provider, <span class="attr">Consumer</span>: CountConsumer &#125; = createContext();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountProvider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  increaseCount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  decreaseCount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="built_in">this</span>.state.count - <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">count:</span> <span class="attr">this.state.count</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">increaseCount:</span> <span class="attr">this.increaseCount</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">decreaseCount:</span> <span class="attr">this.decreaseCount</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">      &gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; CountProvider, CountConsumer &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义CountButton组件</span></span><br><span class="line"><span class="keyword">const</span> CountButton = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">CountConsumer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      // consumer的children必须是一个方法</span></span><br><span class="line"><span class="xml">      &#123;(&#123; increaseCount, decreaseCount &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        const &#123; type &#125; = props;</span></span><br><span class="line"><span class="xml">        const handleClick = type === &quot;increase&quot; ? increaseCount : decreaseCount;</span></span><br><span class="line"><span class="xml">        const btnText = type === &quot;increase&quot; ? &quot;+&quot; : &quot;-&quot;;</span></span><br><span class="line"><span class="xml">        return <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>&#123;btnText&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">      &#125;&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">CountConsumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义count组件，用于显示数量</span></span><br><span class="line"><span class="keyword">const</span> Count = <span class="function">(<span class="params">prop</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">CountConsumer</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;(&#123; count &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        return <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">      &#125;&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">CountConsumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组合</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">CountProvider</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">CountButton</span> <span class="attr">type</span>=<span class="string">&quot;decrease&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Count</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">CountButton</span> <span class="attr">type</span>=<span class="string">&quot;increase&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">CountProvider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>复杂的非父子组件通信在 react 中很难处理，多组件间的数据共享也不好处理，在实际的工作中我们会使用 flux、redux、mobx 来实现</p>
</blockquote>
<h1 id="HOC-高阶组件"><a href="#HOC-高阶组件" class="headerlink" title="HOC(高阶组件)"></a>HOC(高阶组件)</h1><p>Higher-Order Components 就是一个函数，传给它一个组件，它返回一个新的组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> NewComponent = higherOrderComponent(YourComponent);</span><br></pre></td></tr></table></figure>

<p>比如，我们想要我们的组件通过自动注入一个版权信息。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// withCopyright.js 定义一个高阶组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component, Fragment &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withCopyright = <span class="function">(<span class="params">WrappedComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">NewComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">WrappedComponent</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;copy;</span> Silk Software 2019 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withCopyright;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="keyword">import</span> withCopyright <span class="keyword">from</span> <span class="string">&quot;./withCopyright&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Awesome React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>React.js是一个构建用户界面的库<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> CopyrightApp = withCopyright(App);</span><br></pre></td></tr></table></figure>

<p>这样只要我们有需要用到版权信息的组件，都可以直接使用 withCopyright 这个高阶组件包裹即可。</p>
<p>在这里要学习在 CRA 中配置装饰器模式的支持。</p>
<p>#状态管理</p>
<p>##传统 MVC 框架的缺陷</p>
<p><strong>什么是 MVC？</strong></p>
<p><img src="./images/mvc-base.png" alt="image-20190420010944626"></p>
<p><code>MVC</code>的全名是<code>Model View Controller</code>，是模型(model)－视图(view)－控制器(controller)的缩写，是一种软件设计典范。</p>
<p><code>V</code>即 View 视图是指用户看到并与之交互的界面。</p>
<p><code>M</code>即 Model 模型是管理数据 ，很多业务逻辑都在模型中完成。在 MVC 的三个部件中，模型拥有最多的处理任务。</p>
<p><code>C</code>即 Controller 控制器是指控制器接受用户的输入并调用模型和视图去完成用户的需求，控制器本身不输出任何东西和做任何处理。它只是接收请求并决定调用哪个模型构件去处理请求，然后再确定用哪个视图来显示返回的数据。</p>
<p><strong>MVC 只是看起来很美</strong></p>
<p>MVC 框架的数据流很理想，请求先到 Controller, 由 Controller 调用 Model 中的数据交给 View 进行渲染，但是在实际的项目中，又是允许 Model 和 View 直接通信的。然后就出现了这样的结果：</p>
<p><img src="./images/defect-of-mvc.png" alt="image-20190420012010718"></p>
<p>##Flux</p>
<p>在 2013 年，Facebook 让<code>React</code>亮相的同时推出了 Flux 框架，<code>React</code>的初衷实际上是用来替代<code>jQuery</code>的，<code>Flux</code>实际上就可以用来替代<code>Backbone.js</code>，<code>Ember.js</code>等一系列<code>MVC</code>架构的前端 JS 框架。</p>
<p>其实<code>Flux</code>在<code>React</code>里的应用就类似于<code>Vue</code>中的<code>Vuex</code>的作用，但是在<code>Vue</code>中，<code>Vue</code>是完整的<code>mvvm</code>框架，而<code>Vuex</code>只是一个全局的插件。</p>
<p><code>React</code>只是一个 MVC 中的 V(视图层)，只管页面中的渲染，一旦有数据管理的时候，<code>React</code>本身的能力就不足以支撑复杂组件结构的项目，在传统的<code>MVC</code>中，就需要用到 Model 和 Controller。Facebook 对于当时世面上的<code>MVC</code>框架并不满意，于是就有了<code>Flux</code>, 但<code>Flux</code>并不是一个<code>MVC</code>框架，他是一种新的思想。</p>
<p><img src="./images/flux.png" alt="image-20190420012450223"></p>
<ul>
<li>View： 视图层</li>
<li>ActionCreator（动作创造者）：视图层发出的消息（比如 mouseClick）</li>
<li>Dispatcher（派发器）：用来接收 Actions、执行回调函数</li>
<li>Store（数据层）：用来存放应用的状态，一旦发生变动，就提醒 Views 要更新页面</li>
</ul>
<p>Flux 的流程：</p>
<ol>
<li>组件获取到 store 中保存的数据挂载在自己的状态上</li>
<li>用户产生了操作，调用 actions 的方法</li>
<li>actions 接收到了用户的操作，进行一系列的逻辑代码、异步操作</li>
<li>然后 actions 会创建出对应的 action，action 带有标识性的属性</li>
<li>actions 调用 dispatcher 的 dispatch 方法将 action 传递给 dispatcher</li>
<li>dispatcher 接收到 action 并根据标识信息判断之后，调用 store 的更改数据的方法</li>
<li>store 的方法被调用后，更改状态，并触发自己的某一个事件</li>
<li>store 更改状态后事件被触发，该事件的处理程序会通知 view 去获取最新的数据</li>
</ol>
<p>##Redux</p>
<p>React 只是 DOM 的一个抽象层，并不是 Web 应用的完整解决方案。有两个方面，它没涉及。</p>
<ul>
<li>代码结构</li>
<li>组件之间的通信</li>
</ul>
<p>2013 年 Facebook 提出了 Flux 架构的思想，引发了很多的实现。2015 年，Redux 出现，将 Flux 与<a target="_blank" rel="noopener" href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/">函数式编程</a>结合一起，很短时间内就成为了最热门的前端架构。</p>
<p>如果你不知道是否需要 Redux，那就是不需要它</p>
<p>只有遇到 React 实在解决不了的问题，你才需要 Redux</p>
<p>简单说，如果你的 UI 层非常简单，没有很多互动，Redux 就是不必要的，用了反而增加复杂性。</p>
<ul>
<li>用户的使用方式非常简单</li>
<li>用户之间没有协作</li>
<li>不需要与服务器大量交互，也没有使用 WebSocket</li>
<li>视图层（View）只从单一来源获取数据</li>
</ul>
<p><strong>需要使用 Redux 的项目:</strong></p>
<ul>
<li>用户的使用方式复杂</li>
<li>不同身份的用户有不同的使用方式（比如普通用户和管理员）</li>
<li>多个用户之间可以协作</li>
<li>与服务器大量交互，或者使用了 WebSocket</li>
<li>View 要从多个来源获取数据</li>
</ul>
<p><strong>从组件层面考虑，什么样子的需要 Redux：</strong></p>
<ul>
<li>某个组件的状态，需要共享</li>
<li>某个状态需要在任何地方都可以拿到</li>
<li>一个组件需要改变全局状态</li>
<li>一个组件需要改变另一个组件的状态</li>
</ul>
<p><strong>Redux 的设计思想：</strong></p>
<ol>
<li>Web 应用是一个状态机，视图与状态是一一对应的。</li>
<li>所有的状态，保存在一个对象里面（唯一数据源）。</li>
</ol>
<blockquote>
<p>注意：flux、redux 都不是必须和 react 搭配使用的，因为 flux 和 redux 是完整的架构，在学习 react 的时候，只是将 react 的组件作为 redux 中的视图层去使用了。</p>
</blockquote>
<p><strong>Redux 的使用的三大原则：</strong></p>
<ul>
<li>Single Source of Truth(唯一的数据源)</li>
<li>State is read-only(状态是只读的)</li>
<li>Changes are made with pure function(数据的改变必须通过纯函数完成)</li>
</ul>
<h3 id="自己实现-Redux"><a href="#自己实现-Redux" class="headerlink" title="自己实现 Redux"></a>自己实现 Redux</h3><p>不使用 react，直接使用原生的 html/js 来写一个简易的的 redux</p>
<p>基本的状态管理及数据渲染</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Redux principle 01<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>redux principle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;dispatch(&#123;type: &#x27;COUNT_DECREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>-&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;add&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;dispatch(&#123;type: &#x27;COUNT_INCREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>+&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个计数器的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> countState = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">count</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定一个方法叫changeState，用于处理state的数据，每次都返回一个新的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> changeState = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">switch</span> (action.type) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理减</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_DECREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            countState.count -= action.number;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理加</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_INCREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            countState.count += action.number;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">default</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法用于渲染计数器的dom</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> renderCount = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> countDom = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#count&quot;</span>);</span></span><br><span class="line"><span class="javascript">        countDom.innerHTML = state.count;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 首次渲染数据</span></span></span><br><span class="line"><span class="javascript">      renderCount(countState);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个dispatch的方法，接收到动作之后，自动调用</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        changeState(action);</span></span><br><span class="line"><span class="javascript">        renderCount(countState);</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建 createStore 方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Redux principle 02<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>redux principle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_DECREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>-&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;add&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_INCREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>+&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法，用于集中管理state和dispatch</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> createStore = <span class="function">(<span class="params">state, changeState</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// getState用于获取状态</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> getState = <span class="function">() =&gt;</span> state;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个监听器，用于管理一些方法</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> listeners = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> listeners.push(listener);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个dispatch方法，让每次有action传入的时候返回render执行之后的结果</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 调用changeState来处理数据</span></span></span><br><span class="line"><span class="javascript">          changeState(state, action);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 让监听器里的所以方法运行</span></span></span><br><span class="line"><span class="javascript">          listeners.forEach(<span class="function">(<span class="params">listener</span>) =&gt;</span> listener());</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          getState,</span></span><br><span class="line"><span class="javascript">          dispatch,</span></span><br><span class="line"><span class="javascript">          subscribe,</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个计数器的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> countState = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">count</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定一个方法叫changeState，用于处理state的数据，每次都返回一个新的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> changeState = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">switch</span> (action.type) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理减</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_DECREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            state.count -= action.number;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理加</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_INCREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            state.count += action.number;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">default</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建一个store</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> store = createStore(countState, changeState);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法用于渲染计数器的dom</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> renderCount = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> countDom = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#count&quot;</span>);</span></span><br><span class="line"><span class="javascript">        countDom.innerHTML = store.getState().count;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初次渲染数据</span></span></span><br><span class="line"><span class="javascript">      renderCount();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 监听，只要有dispatch，这个方法就会自动运行</span></span></span><br><span class="line"><span class="javascript">      store.subscribe(renderCount);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>让 changeState 方法变为一个纯函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Redux principle 03<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>redux principle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_DECREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>-&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;add&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_INCREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>+&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法，用于集中管理state和dispatch</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> createStore = <span class="function">(<span class="params">state, changeState</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// getState用于获取状态</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> getState = <span class="function">() =&gt;</span> state;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个监听器，用于管理一些方法</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> listeners = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> listeners.push(listener);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个dispatch方法，让每次有action传入的时候返回render执行之后的结果</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 调用changeState来处理数据</span></span></span><br><span class="line"><span class="javascript">          state = changeState(state, action);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 让监听器里的所有方法运行</span></span></span><br><span class="line"><span class="javascript">          listeners.forEach(<span class="function">(<span class="params">listener</span>) =&gt;</span> listener());</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          getState,</span></span><br><span class="line"><span class="javascript">          dispatch,</span></span><br><span class="line"><span class="javascript">          subscribe,</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个计数器的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> countState = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">count</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定一个方法叫changeState，用于处理state的数据，每次都返回一个新的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> changeState = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">switch</span> (action.type) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理减</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_DECREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">              ...state,</span></span><br><span class="line"><span class="javascript">              <span class="attr">count</span>: state.count - action.number,</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理加</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_INCREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">              ...state,</span></span><br><span class="line"><span class="javascript">              <span class="attr">count</span>: state.count + action.number,</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">default</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> state;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建一个store</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> store = createStore(countState, changeState);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法用于渲染计数器的dom</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> renderCount = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> countDom = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#count&quot;</span>);</span></span><br><span class="line"><span class="javascript">        countDom.innerHTML = store.getState().count;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初次渲染数据</span></span></span><br><span class="line"><span class="javascript">      renderCount();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 监听，只要有dispatch，这个方法就会自动运行</span></span></span><br><span class="line"><span class="javascript">      store.subscribe(renderCount);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>合并 state 和 changeState(最终版)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Redux principle 04<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>redux principle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_DECREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>-&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;add&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onclick</span>=<span class="string">&quot;store.dispatch(&#123;type: &#x27;COUNT_INCREMENT&#x27;, number: 10&#125;)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>+&lt;/span</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法，用于集中管理state和dispatch, changeState改名了，专业的叫法是reducer</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个初始的state</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> state = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// getState用于获取状态</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> getState = <span class="function">() =&gt;</span> state;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个监听器，用于管理一些方法</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> listeners = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> listeners.push(listener);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 定义一个dispatch方法，让每次有action传入的时候返回reducer执行之后的结果</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 调用reducer来处理数据</span></span></span><br><span class="line"><span class="javascript">          state = reducer(state, action);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 让监听器里的所有方法运行</span></span></span><br><span class="line"><span class="javascript">          listeners.forEach(<span class="function">(<span class="params">listener</span>) =&gt;</span> listener());</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//  初始化state</span></span></span><br><span class="line"><span class="javascript">        dispatch(&#123;&#125;);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          getState,</span></span><br><span class="line"><span class="javascript">          dispatch,</span></span><br><span class="line"><span class="javascript">          subscribe,</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个计数器的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> countState = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">count</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定一个方法叫changeState，用于处理state的数据，每次都返回一个新的状态</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> changeState = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果state是null, 就返回countState</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!state) <span class="keyword">return</span> countState;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">switch</span> (action.type) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理减</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_DECREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">              ...state,</span></span><br><span class="line"><span class="javascript">              <span class="attr">count</span>: state.count - action.number,</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 处理加</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">case</span> <span class="string">&quot;COUNT_INCREMENT&quot;</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">              ...state,</span></span><br><span class="line"><span class="javascript">              <span class="attr">count</span>: state.count + action.number,</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">default</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> state;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建一个store</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> store = createStore(changeState);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 定义一个方法用于渲染计数器的dom</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> renderCount = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> countDom = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#count&quot;</span>);</span></span><br><span class="line"><span class="javascript">        countDom.innerHTML = store.getState().count;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初次渲染数据</span></span></span><br><span class="line"><span class="javascript">      renderCount();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 监听，只要有dispatch，renderCount就会自动运行</span></span></span><br><span class="line"><span class="javascript">      store.subscribe(renderCount);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>###使用 Redux 框架</p>
<p><strong>Redux 的流程：</strong></p>
<p><img src="./images/redux.png" alt="image-20190420013410981"></p>
<p>1.store 通过 reducer 创建了初始状态</p>
<p>2.view 通过 store.getState()获取到了 store 中保存的 state 挂载在了自己的状态上</p>
<p>3.用户产生了操作，调用了 actions 的方法</p>
<p>4.actions 的方法被调用，创建了带有标示性信息的 action</p>
<p>5.actions 将 action 通过调用 store.dispatch 方法发送到了 reducer 中</p>
<p>6.reducer 接收到 action 并根据标识信息判断之后返回了新的 state</p>
<p>7.store 的 state 被 reducer 更改为新 state 的时候，store.subscribe 方法里的回调函数会执行，此时就可以通知 view 去重新获取 state</p>
<p><strong>Reducer 必须是一个纯函数：</strong></p>
<p>Reducer 函数最重要的特征是，它是一个纯函数。也就是说，只要是同样的输入，必定得到同样的输出。Reducer 不是只有 Redux 里才有，数组方法<code>reduce</code>, 它的第一个参数就是一个 reducer</p>
<p>纯函数是函数式编程的概念，必须遵守以下一些约束。</p>
<ul>
<li><p>不得改写参数</p>
</li>
<li><p>不能调用系统 I/O 的 API</p>
</li>
<li><p>不能调用 Date.now()或者 Math.random()等不纯的方法，因为每次会得到不一样的结果</p>
</li>
</ul>
<p>由于 Reducer 是纯函数，就可以保证同样的 State，必定得到同样的 View。但也正因为这一点，Reducer 函数里面不能改变 State，必须返回一个全新的对象，请参考下面的写法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// State 是一个对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; thingToChange &#125;);</span><br><span class="line">  <span class="comment">// 或者</span></span><br><span class="line">  <span class="keyword">return</span> &#123; ...state, ...newState &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State 是一个数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...state, newItem];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最好把 State 对象设成只读。要得到新的 State，唯一办法就是生成一个新对象。这样的好处是，任何时候，与某个 View 对应的 State 总是一个不变(immutable)的对象。</p>
<p>我们可以通过在 createStore 中传入第二个参数来设置默认的 state，但是这种形式只适合于只有一个 reducer 的时候。</p>
<p><strong>划分 reducer</strong>:</p>
<p>因为一个应用中只能有一个大的 state，这样的话 reducer 中的代码将会特别特别的多，那么就可以使用 combineReducers 方法将已经分开的 reducer 合并到一起</p>
<blockquote>
<p>注意：</p>
<ol>
<li>分离 reducer 的时候，每一个 reducer 维护的状态都应该不同</li>
<li>通过 store.getState 获取到的数据也是会按照 reducers 去划分的</li>
<li>划分多个 reducer 的时候，默认状态只能创建在 reducer 中，因为划分 reducer 的目的，就是为了让每一个 reducer 都去独立管理一部分状态</li>
</ol>
</blockquote>
<p>关于 action/reducer/store 的更多概念，请查看<a target="_blank" rel="noopener" href="https://www.redux.org.cn/">官网</a></p>
<p><strong>Redux 异步</strong></p>
<p>通常情况下，action 只是一个对象，不能包含异步操作，这导致了很多创建 action 的逻辑只能写在组件中，代码量较多也不便于复用，同时对该部分代码测试的时候也比较困难，组件的业务逻辑也不清晰，使用中间件了之后，可以通过 actionCreator 异步编写 action，这样代码就会拆分到 actionCreator 中，可维护性大大提高，可以方便于测试、复用，同时 actionCreator 还集成了异步操作中不同的 action 派发机制，减少编码过程中的代码量</p>
<p>常见的异步库：</p>
<ul>
<li>Redux-thunk(就用这个)</li>
<li>Redux-saga</li>
<li>Redux-effects</li>
<li>Redux-side-effects</li>
<li>Redux-loop</li>
<li>Redux-observable</li>
<li>…</li>
</ul>
<p>基于 Promise 的异步库：</p>
<ul>
<li>Redux-promise</li>
<li>Redux-promises</li>
<li>Redux-simple-promise</li>
<li>Redux-promise-middleware</li>
<li>…</li>
</ul>
<p>###容器组件（Smart/Container Components）和展示组件（Dumb/Presentational Components）</p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">展示组件</th>
<th align="left">容器组件</th>
</tr>
</thead>
<tbody><tr>
<td align="right">作用</td>
<td align="left">描述如何展现（骨架、样式）</td>
<td align="left">描述如何运行（数据获取、状态更新）</td>
</tr>
<tr>
<td align="right">直接使用 Redux</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="right">数据来源</td>
<td align="left">props</td>
<td align="left">监听 Redux state</td>
</tr>
<tr>
<td align="right">数据修改</td>
<td align="left">从 props 调用回调函数</td>
<td align="left">向 Redux 派发 actions</td>
</tr>
<tr>
<td align="right">调用方式</td>
<td align="left">手动</td>
<td align="left">通常由 React Redux 生成</td>
</tr>
</tbody></table>
<h3 id="使用-react-redux"><a href="#使用-react-redux" class="headerlink" title="使用 react-redux"></a>使用 react-redux</h3><p>可以先结合<code>context</code>来手动连接 react 和 redux。</p>
<p>react-redux 提供两个核心的 api：</p>
<ul>
<li>Provider: 提供 store</li>
<li>connect: 用于连接容器组件和展示组件</li>
</ul>
<ol>
<li><p>Provider</p>
<p>根据单一 store 原则 ，一般只会出现在整个应用程序的最顶层。</p>
</li>
<li><p>connect</p>
<p>语法格式为</p>
<p><code>connect(mapStateToProps?, mapDispatchToProps?, mergeProps?, options?)(component)</code></p>
<p>一般来说只会用到前面两个，它的作用是：</p>
<ul>
<li>把<code>store.getState()</code>的状态转化为展示组件的<code>props</code></li>
<li>把<code>actionCreators</code>转化为展示组件<code>props</code>上的方法</li>
</ul>
</li>
</ol>
<blockquote>
<p>特别强调：</p>
<p>官网上的第二个参数为 mapDispatchToProps, 实际上就是 actionCreators</p>
</blockquote>
<p>只要上层中有<code>Provider</code>组件并且提供了<code>store</code>, 那么，子孙级别的任何组件，要想使用<code>store</code>里的状态，都可以通过<code>connect</code>方法进行连接。如果只是想连接<code>actionCreators</code>，可以第一个参数传递为<code>null</code></p>
<h1 id="React-Router"><a href="#React-Router" class="headerlink" title="React Router"></a>React Router</h1><p>React Router 现在的版本是 5, 于 2019 年 3 月 21 日搞笑的发布，<a target="_blank" rel="noopener" href="https://reacttraining.com/blog/react-router-v5/">搞笑的官网链接</a>， 本来是要发布 4.4 的版本的，结果成了 5。从 4 开始，使用方式相对于之前版本的思想有所不同。之前版本的思想是传统的思想：<strong>路由应该统一在一处渲染</strong>， Router 4 之后是这样的思想：<strong>一切皆组件</strong></p>
<p>React Router 包含了四个包:</p>
<table>
<thead>
<tr>
<th>包名</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router"><code>react-router</code></a></td>
<td>React Router 核心 api</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom"><code>react-router-dom</code></a></td>
<td>React Router 的 DOM 绑定，在浏览器中运行不需要额外安装<code>react-router</code></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-native"><code>react-router-native</code></a></td>
<td><a target="_blank" rel="noopener" href="https://facebook.github.io/react-native/">React Native</a> 中使用，而实际的应用中，其实不会使用这个。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-config"><code>react-router-config</code></a></td>
<td>静态路由的配置</td>
</tr>
</tbody></table>
<p>主要使用<code>react-router-dom</code></p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>正常情况下，直接按照<a target="_blank" rel="noopener" href="https://reacttraining.com/react-router/web/guides/quick-start">官网</a>的 demo 就理解 路由的使用方式，有几个点需要特别的强调：</p>
<ul>
<li>Route 组件的 exact 属性</li>
</ul>
<p><code>exact</code>属性标识是否为严格匹配， 为<code>true</code>是表示严格匹配，为<code>false</code>时为正常匹配。</p>
<ul>
<li>Route 组件的 render 属性而不是 component 属性</li>
</ul>
<p>怎么在渲染组件的时候，对组件传递属性呢？使用<code>component</code>的方式是不能直接在组件上添加属性的。所以，React Router 的<code>Route</code>组件提供了另一种渲染组件的方式 <code>render</code>, 这个常用于页面组件级别的权限管理。</p>
<ul>
<li><p>路由的参数传递与获取</p>
</li>
<li><p>Switch 组件</p>
</li>
</ul>
<p>总是渲染第一个匹配到的组件</p>
<ul>
<li><p>处理 404 与默认页</p>
</li>
<li><p>withRoute 高阶组件的使用</p>
</li>
<li><p>管理一个项目路由的方法</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://reacttraining.com/react-router/web/guides/code-splitting">code spliting</a></p>
</li>
<li><p>HashRouter 和 BrowserRouter 的区别，前端路由和后端路由的区别。</p>
</li>
</ul>
<h2 id="React-Router-基本原理"><a href="#React-Router-基本原理" class="headerlink" title="React Router 基本原理"></a>React Router 基本原理</h2><p>React Router 甚至大部分的前端路由都是依赖于<a target="_blank" rel="noopener" href="https://github.com/browserstate/history.js"><code>history.js</code></a>的，它是一个独立的第三方 js 库。可以用来兼容在不同浏览器、不同环境下对历史记录的管理，拥有统一的 API。</p>
<ul>
<li>老浏览器的 history: 通过<code>hash</code>来存储在不同状态下的<code>history</code>信息，对应<code>createHashHistory</code>，通过检测<code>location.hash</code>的值的变化，使用<code>location.replace</code>方法来实现 url 跳转。通过注册监听<code>window</code>对象上的<code>hashChange</code>事件来监听路由的变化，实现历史记录的回退。</li>
<li>高版本浏览器: 利用 HTML5 里面的 history，对应<code>createBrowserHistory</code>, 使用包括<code>pushState</code>， <code>replaceState</code>方法来进行跳转。通过注册监听<code>window</code>对象上的<code>popstate</code>事件来监听路由的变化，实现历史记录的回退。</li>
<li>node 环境下: 在内存中进行历史记录的存储，对应<code>createMemoryHistory</code>。直接在内存里<code>push</code>和<code>pop</code>状态。</li>
</ul>
<h1 id="Immutable-js"><a href="#Immutable-js" class="headerlink" title="Immutable.js"></a>Immutable.js</h1><p>作为了解的内容，很多时候可能不一定需要。</p>
<h2 id="JavaScript-数据修改的问题"><a href="#JavaScript-数据修改的问题" class="headerlink" title="JavaScript 数据修改的问题"></a>JavaScript 数据修改的问题</h2><p>看一段大家熟悉的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&quot;Silk Software&quot;</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> newState = state;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newState === state); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>由于 js 的对象和数组都是引用类型。所以 newState 的 state 实际上是指向于同一块内存地址的, 所以结果是 newState 和 state 是相等的。</p>
<p>尝试修改一下数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&quot;Silk Software&quot;</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> newState = state;</span><br><span class="line"></span><br><span class="line">newState.str = <span class="string">&quot;Leo Chow&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state.str, newState.str);</span><br></pre></td></tr></table></figure>

<p>可以看到，newState 的修改也会引起 state 的修改。要解决这个问题，js 中提供了另一种修改数据的方式，要修改一个数据之前先制作一份数据的拷贝，像这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&quot;Silk Software&quot;</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> newState = <span class="built_in">Object</span>.assign(&#123;&#125;, state);</span><br><span class="line"></span><br><span class="line">newState.str = <span class="string">&quot;Silk Software Bundle FE&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state.str, newState.str);</span><br></pre></td></tr></table></figure>

<p>我们可以使用很多方式在 js 中复制数据，比如<code>…</code>, <code>Object.assign</code>, <code>Object.freeze</code>, <code>slice</code>, <code>concat</code>, <code>map</code>, <code>filter</code>, <code>reduce</code>等方式进行复制，但这些都是浅拷贝，就是只拷贝第一层数据，更深层的数据还是同一个引用，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&quot;Silk Software&quot;</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> newState = <span class="built_in">Object</span>.assign(&#123;&#125;, state);</span><br><span class="line"></span><br><span class="line">newState.obj.y = <span class="number">2</span>;</span><br><span class="line">newState.arr.push(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state, newState);</span><br></pre></td></tr></table></figure>

<p>可以看到，当在更改 newState 更深层次的数据的时候，还是会影响到 state 的值。如果要深层复制，就得一层一层的做递归拷贝，这是一个复杂的问题。虽然有些第三方的库已经帮我们做好了，比如<code>lodash</code>的<code>cloneDeep</code>方法。深拷贝是非常消耗性能的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; cloneDeep &#125; <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&quot;Silk Software&quot;</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> newState = cloneDeep(state);</span><br><span class="line"></span><br><span class="line">newState.obj.y = <span class="number">2</span>;</span><br><span class="line">newState.arr.push(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state, newState);</span><br></pre></td></tr></table></figure>

<h2 id="什么是不可变数据"><a href="#什么是不可变数据" class="headerlink" title="什么是不可变数据"></a>什么是不可变数据</h2><p>不可变数据 (Immutable Data )就是一旦创建，就不能再被更改的数据。对 Immutable 对象的任何修改或添加删除操作都会返回一个新的 Immutable 对象。Immutable 实现的原理是持久化数据结构（ Persistent Data Structure），也就是使用旧数据创建新数据时，要保证旧数据同时可用且不变。同时为了避免 deepCopy 把所有节点都复制一遍带来的 s 性能损耗，Immutable 使用了 结构共享（Structural Sharing），即如果对象树中一个节点发生变化，只修改这个节点和受它影响的父节点，其它节点则进行共享。</p>
<p><img src="./images/structure-sharing.png" alt="react"></p>
<h2 id="immutable-js-的优缺点"><a href="#immutable-js-的优缺点" class="headerlink" title="immutable.js 的优缺点"></a>immutable.js 的优缺点</h2><p><strong>优点：</strong></p>
<ul>
<li>降低 mutable 带来的复杂度</li>
<li>节省内存</li>
<li>历史追溯性（时间旅行）：时间旅行指的是，每时每刻的值都被保留了，想回退到哪一步只要简单的将数据取出就行，想一下如果现在页面有个撤销的操作，撤销前的数据被保留了，只需要取出就行，这个特性在 redux 或者 flux 中特别有用</li>
<li>拥抱函数式编程：immutable 本来就是函数式编程的概念，纯函数式编程的特点就是，只要输入一致，输出必然一致，相比于面向对象，这样开发组件和调试更方便。推荐一本函数式编程的在线免费书《<a target="_blank" rel="noopener" href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/">JS 函数式编程指南</a>》, 此书可以推荐给学生做为课外补充阅读。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>需要重新学习 api</li>
<li>资源包大小增加（源码 5000 行左右）</li>
<li>容易与原生对象混淆：由于 api 与原生不同，混用的话容易出错。</li>
</ul>
<h2 id="使用-Immutable-js"><a href="#使用-Immutable-js" class="headerlink" title="使用 Immutable.js"></a>使用 Immutable.js</h2><p>参考<a target="_blank" rel="noopener" href="https://immutable-js.github.io/immutable-js/">官网</a>重点理解数据不可变数据的创建、更新及比较方式 。对于就业班来说，掌握以下知识点即可。</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newMap = map.set(<span class="string">&quot;b&quot;</span>, <span class="number">20</span>); <span class="comment">// immutable数据每次都是生成新的再重新调用set进行修改，所以需要 重新赋值给一个新的变量</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(map, newMap); <span class="comment">// immutable.Map不是原生的对象</span></span><br><span class="line"><span class="built_in">console</span>.log(map.b, newMap.b); <span class="comment">// immutable.Map不是原生的对象, 所以是undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(map.get(<span class="string">&quot;b&quot;</span>), newMap.get(<span class="string">&quot;b&quot;</span>)); <span class="comment">// 要取值，需要调用get(key)方法，可以看到，两个值不一样</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Map</span>.isMap(map), <span class="built_in">Map</span>.isMap(obj)); <span class="comment">// true false, 使用Map.isMap来判断是否是一个immutable.Map类型</span></span><br></pre></td></tr></table></figure>

<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; List &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = List([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> newList = list.push(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(list, newList);</span><br><span class="line"><span class="built_in">console</span>.log(list[<span class="number">4</span>], newList[<span class="number">4</span>]); <span class="comment">// undefined undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(list.get(<span class="number">4</span>), newList.get(<span class="number">4</span>)); <span class="comment">// undefined 5</span></span><br><span class="line"><span class="built_in">console</span>.log(list.size, newList.size); <span class="comment">// 4 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(List.isList(list), List.isList(arr)); <span class="comment">// true false</span></span><br></pre></td></tr></table></figure>

<h3 id="equals-amp-is"><a href="#equals-amp-is" class="headerlink" title="equals &amp; is"></a>equals &amp; is</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span>, is &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> anotherMap = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(map == anotherMap); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(map === anotherMap); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(map.equals(anotherMap)); <span class="comment">// 使用equals进行比较 true</span></span><br><span class="line"><span class="built_in">console</span>.log(is(map, anotherMap)); <span class="comment">// 使用is进行比较 true</span></span><br></pre></td></tr></table></figure>

<h3 id="List-常用-api"><a href="#List-常用-api" class="headerlink" title="List 常用 api"></a>List 常用 api</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; List &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = List([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> list1 = list.push(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> list2 = list1.unshift(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> list3 = list.concat(list1, list2);</span><br><span class="line"><span class="keyword">const</span> list4 = list.map(<span class="function">(<span class="params">v</span>) =&gt;</span> v * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(list.size, list1.size, list2.size, list3.size, list4.toJS()); <span class="comment">// 4 5 6 15, [2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>

<h3 id="Map-常用-api"><a href="#Map-常用-api" class="headerlink" title="Map 常用 api"></a>Map 常用 api</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> alpha = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> objKeys = alpha.map(<span class="function">(<span class="params">v, k</span>) =&gt;</span> k);</span><br><span class="line"><span class="built_in">console</span>.log(objKeys.join()); <span class="comment">// a, b, c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map1 = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">d</span>: <span class="number">4</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">d</span>: <span class="number">400</span>,</span><br><span class="line">  <span class="attr">e</span>: <span class="number">50</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mergedMap = map1.merge(map2, obj);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mergedMap.toObject());</span><br><span class="line"><span class="built_in">console</span>.log(mergedMap.toJS());</span><br></pre></td></tr></table></figure>

<h3 id="嵌套数据结构"><a href="#嵌套数据结构" class="headerlink" title="嵌套数据结构"></a>嵌套数据结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; fromJS &#125; = <span class="built_in">require</span>(<span class="string">&quot;immutable&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> nested = fromJS(&#123; <span class="attr">a</span>: &#123; <span class="attr">b</span>: &#123; <span class="attr">c</span>: [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] &#125; &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nested2 = nested.mergeDeep(&#123; <span class="attr">a</span>: &#123; <span class="attr">b</span>: &#123; <span class="attr">d</span>: <span class="number">6</span> &#125; &#125; &#125;);</span><br><span class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5 ], d: 6 &#125; &#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(nested2.getIn([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;d&quot;</span>])); <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nested3 = nested2.updateIn([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;d&quot;</span>], <span class="function">(<span class="params">value</span>) =&gt;</span> value + <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(nested3);</span><br><span class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5 ], d: 7 &#125; &#125; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nested4 = nested3.updateIn([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>], <span class="function">(<span class="params">list</span>) =&gt;</span> list.push(<span class="number">6</span>));</span><br><span class="line"><span class="comment">// Map &#123; a: Map &#123; b: Map &#123; c: List [ 3, 4, 5, 6 ], d: 7 &#125; &#125; &#125;</span></span><br></pre></td></tr></table></figure>

<p>##在 redux 中使用 immutable.js</p>
<p><a target="_blank" rel="noopener" href="https://redux.js.org/recipes/using-immutablejs-with-redux">redux 官网</a>推荐使用<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/redux-immutable">redux-immutable</a>进行 redux 和 immutable 的集成。几个注意点：</p>
<p><code>redux</code>中，利用<code>combineReducers</code>来合并多个<code>reduce</code>, <code>redux</code>自带的<code>combineReducers</code>只支持原生 js 形式的，所以需要使用<code>redux-immutable</code>提供的<code>combineReducers</code>来代替</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用redux-immutable提供的combineReducers方法替换redux里的combineReducers</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux-immutable&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducerOne <span class="keyword">from</span> <span class="string">&quot;./reducerOne&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducerTwo <span class="keyword">from</span> <span class="string">&quot;./reducerTwo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  reducerOne,</span><br><span class="line">  reducerTwo,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>

<p><code>reducer</code>中的<code>initialState</code>也需要初始化成<code>immutable</code>类型, 比如一个 counter 的 reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">&quot;immutable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ActionTypes <span class="keyword">from</span> <span class="string">&quot;../actions&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = <span class="built_in">Map</span>(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = initialState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ActionTypes.INCREAMENT:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">&quot;count&quot;</span>, state.get(<span class="string">&quot;count&quot;</span>) + <span class="number">1</span>); <span class="comment">// 使用set或setIn来更改值, get或者getIn来取值</span></span><br><span class="line">    <span class="keyword">case</span> ActionTypes.DECREAMENT:</span><br><span class="line">      <span class="keyword">return</span> state.set(<span class="string">&quot;count&quot;</span>, state.get(<span class="string">&quot;count&quot;</span>) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>state</code>成为了<code>immutable</code>类型，<code>connect</code>的<code>mapStateToProp</code>也需要相应的改变</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">count</span>: state.getIn([<span class="string">&quot;counter&quot;</span>, <span class="string">&quot;count&quot;</span>]), <span class="comment">// 永远不要在mapStateToProps里使用`toJS`方法，因为它永远返回一个新的对象</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在<code>shouldComponentUpdate</code>里就可以使用<code>immutable.is</code>或者<code>instance.equals</code>来进行数据的对比了。</p>
<h1 id="Mobx"><a href="#Mobx" class="headerlink" title="Mobx"></a>Mobx</h1><p>作为了解的内容，在项目中使用 redux 的情况更多。</p>
<p>Mobx 是一个功能强大，上手非常容易的状态管理工具。redux 的作者也曾经向大家推荐过它，在不少情况下可以使用 Mobx 来替代掉 redux。</p>
<p><img src="./images/mobx-flow.png" alt="MobX unidirectional flow"></p>
<p>这张图来自于官网，把这张图理解清楚了。基本上对于 mobx 的理解就算入门了。</p>
<p>官网有明确的核心概念使用方法，并配有<a target="_blank" rel="noopener" href="https://egghead.io/courses/manage-complex-state-in-react-apps-with-mobx">egghead</a>的视频教程。这里就不一一赘述了。</p>
<p>要特别注意当使用 <code>mobx-react</code> 时可以定义一个新的生命周期钩子函数 <code>componentWillReact</code>。当组件因为它观察的数据发生了改变，它会安排重新渲染，这个时候 <code>componentWillReact</code> 会被触发。这使得它很容易追溯渲染并找到导致渲染的操作(action)。</p>
<ul>
<li><p><code>componentWillReact</code> 不接收参数</p>
</li>
<li><p><code>componentWillReact</code> 初始化渲染前不会触发 (使用 <code>componentWillMount</code> 替代)</p>
</li>
<li><p><code>componentWillReact</code> 对于 mobx-react@4+, 当接收新的 props 时并在 <code>setState</code> 调用后会触发此钩子</p>
</li>
<li><p>要触发<code>componentWillReact</code>必须在 render 里面用到被观察的变量</p>
</li>
<li><p>使用 Mobx 之后不会触发<code>componentWillReceiveProps</code></p>
</li>
</ul>

        </div>
        
                    <!-- <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
            
        </div>
        <div>
            
        </div>
    </div> -->
</article>
<div class="article-nav prev-next-wrap clearfix">
    
            
</div>

    <div id="comments">
        
    
<div class="utteranc">
  
  <script
    src='https://utteranc.es/client.js'
    repo='shenliyang/snippet-comment'
    issue-term='pathname'
    issue-number=''
    theme='github-light'
    label=''
    crossorigin='anonymous'
    async
  ></script>
</div>



    </div>
    
                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            Table of Contents
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-React"><span class="toc-text">关于 React</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E7%9A%84%E8%B5%B7%E6%BA%90%E5%92%8C%E5%8F%91%E5%B1%95"><span class="toc-text">React 的起源和发展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E4%B8%8E%E4%BC%A0%E7%BB%9F-MVC-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">React 与传统 MVC 的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E4%BD%93%E7%8E%B0%EF%BC%9A%E8%99%9A%E6%8B%9F-DOM"><span class="toc-text">React 高性能的体现：虚拟 DOM</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#React-%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-text">React 高性能的原理：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#React-Fiber"><span class="toc-text">React Fiber:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E7%9A%84%E7%89%B9%E7%82%B9%E5%92%8C%E4%BC%98%E5%8A%BF"><span class="toc-text">React 的特点和优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E7%9B%B8%E5%85%B3%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">React 相关的解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E8%84%9A%E6%89%8B%E6%9E%B6-create-react-app"><span class="toc-text">官方脚手架 create-react-app</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AA-react-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">编写第一个 react 应用程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E4%B8%8E%E7%BB%84%E4%BB%B6"><span class="toc-text">元素与组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="toc-text">函数式组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#class-%E7%BB%84%E4%BB%B6"><span class="toc-text">class 组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E8%80%81%E7%9A%84%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-text">更老的一种方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E7%BB%84%E5%90%88%E3%80%81%E5%B5%8C%E5%A5%97"><span class="toc-text">组件的组合、嵌套</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8C%82%E8%BD%BD%E6%96%B9%E5%BC%8F"><span class="toc-text">组件的数据挂载方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-props"><span class="toc-text">属性(props)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#props-children"><span class="toc-text">props.children</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-prop-types-%E6%A3%80%E6%9F%A5-props"><span class="toc-text">使用 prop-types 检查 props</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-vs-%E7%8A%B6%E6%80%81"><span class="toc-text">属性 vs 状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E4%B8%8E%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">受控组件与非受控组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE"><span class="toc-text">渲染数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">事件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6"><span class="toc-text">绑定事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6-handler-%E7%9A%84%E5%86%99%E6%B3%95"><span class="toc-text">事件 handler 的写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Event-%E5%AF%B9%E8%B1%A1"><span class="toc-text">Event 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="toc-text">事件的参数传递</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Hooks"><span class="toc-text">React Hooks</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1"><span class="toc-text">组件通信</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HOC-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">HOC(高阶组件)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0-Redux"><span class="toc-text">自己实现 Redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-react-redux"><span class="toc-text">使用 react-redux</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React-Router"><span class="toc-text">React Router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">使用方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Router-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-text">React Router 基本原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Immutable-js"><span class="toc-text">Immutable.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript-%E6%95%B0%E6%8D%AE%E4%BF%AE%E6%94%B9%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">JavaScript 数据修改的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE"><span class="toc-text">什么是不可变数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#immutable-js-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">immutable.js 的优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Immutable-js"><span class="toc-text">使用 Immutable.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Map"><span class="toc-text">Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List"><span class="toc-text">List</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#equals-amp-is"><span class="toc-text">equals &amp; is</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-%E5%B8%B8%E7%94%A8-api"><span class="toc-text">List 常用 api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Map-%E5%B8%B8%E7%94%A8-api"><span class="toc-text">Map 常用 api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">嵌套数据结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mobx"><span class="toc-text">Mobx</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2021
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links"
                        target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>




<script src="/fq6991.githup.io/js/app.js?rev=@@hash.js"></script>

</body>
</html>